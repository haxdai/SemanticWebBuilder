<template method="setHeaders" Content-Type="text/html"  Cache-Control="no-cache" Pragma="no-cache"  response="{response}" />
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html>
    <META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html">
    <META HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE">
    <META HTTP-EQUIV="PRAGMA" CONTENT="NO-CACHE">
    <head>
        <title>Semantic WebBuilder 4</title>
        
        <style type="text/css">
            @import "/swb/swbadmin/js/dojo1.1/dojo/resources/dojo.css";
            @import "/swb/swbadmin/js/dojo1.1/dijit/themes/soria/soria.css";
            @import "/swb/swbadmin/js/dojo1.1/dijit/demos/mail/mail.css";
            @import "/swb/swbadmin/css/swb.css";
            
            #main .dijitSplitterH { height: 7px }
            #main .dijitSplitterV { width: 7px }
            
            /* pre-loader specific stuff to prevent unsightly flash of unstyled content */
            #loader { 
                padding:0;
                margin:0;
                position:absolute; 
                top:0; left:0; 
                width:100%; height:100%;  
                background:#ededed; 
                z-index:999;
                vertical-align:center; 
            }
            #loaderInner {
                padding:5px;
                position:relative; 
                left:0;
                top:0; 		
                width:230px; 
                background:#3c3; 
                color:#fff; 			
                
            }
        </style>
        
        <script type="text/javascript" src="/swb/swbadmin/js/dojo1.1/dojo/dojo.js" 
                djConfig="parseOnLoad: false, isDebug: false"></script>
        
        <script type="text/javascript" src="/swb/swbadmin/js/dojo1.1/dijit/dijit.js"></script>
        <script type="text/javascript" src="/swb/swbadmin/js/dojo1.1/dijit/dijit-all.js" charset="utf-8"></script>
        
        <script type="text/javascript"> // dojo.requires()
            
            var paneId=1;
            
            
            dojo.require("dijit.Menu");
            dojo.require("dijit._Calendar");
            dojo.require("dijit.ColorPalette");
            dojo.require("dijit.ProgressBar");
            dojo.require("dijit.TitlePane");
            dojo.require("dijit.Tooltip");
            dojo.require("dijit.Tree");
            
            // editor:
            dojo.require("dijit.Editor"); 
            
            // dnd:
            dojo.require("dojo.dnd.Source");
            
            // various Form elemetns
            
            dojo.require("dijit.form.CheckBox");
            dojo.require("dijit.form.Textarea");
            dojo.require("dijit.form.FilteringSelect");
            dojo.require("dijit.form.TextBox");
            dojo.require("dijit.form.DateTextBox");	
            dojo.require("dijit.form.TimeTextBox");	
            dojo.require("dijit.form.Button");
            dojo.require("dijit.InlineEditBox");
            dojo.require("dijit.form.NumberSpinner");
            dojo.require("dijit.form.Slider"); 
            
            // layouts used in page
            
            dojo.require("dijit.layout.AccordionContainer");
            dojo.require("dijit.layout.ContentPane");
            dojo.require("dijit.layout.TabContainer");
            dojo.require("dijit.layout.BorderContainer");
            dojo.require("dijit.Dialog");
            
            // scan page for widgets and instantiate them
            dojo.require("dojo.parser");	
            
            // humm?		
            dojo.require("dojo.date.locale");
            
            // for the Tree
            dojo.require("dojo.data.ItemFileReadStore");
            
            // for the colorpalette
            function setColor(color){
                var theSpan = dojo.byId("outputSpan");
                dojo.style(theSpan,"color",color); 
                theSpan.innerHTML = color;
            }
            
            // for the calendar
            function myHandler(id,newValue){
                console.debug("onChange for id = " + id + ", value: " + newValue);
            }
            
            dojo.addOnLoad(function() {
                
                var start = new Date().getTime();
                dojo.parser.parse(dojo.byId('container')); 
                console.info("Total parse time: " + (new Date().getTime() - start) + "ms");
                
                dojo.byId('loaderInner').innerHTML += " done.";
                setTimeout(function hideLoader(){
                    var loader = dojo.byId('loader'); 
                    dojo.fadeOut({ node: loader, duration:500,
                        onEnd: function(){ 
                            loader.style.display = "none"; 
                        }
                    }).play();
                }, 250);
            });
            
            function getHtml(url, tagid)
            {
                dojo.xhrGet({
                    url: url,
                    load: function(response, ioArgs){
                        dojo.byId(tagid).innerHTML = response;
                        return response;
                    },
                    error: function(response, ioArgs){
                        dojo.byId(tagid).innerHTML = 
                            "An error occurred, with response: " + response;
                        return response;
                    },
                    handleAs: "text"
                });            
            }
            
            function addNewTab(id, title, icon)
            {
                var objid=id+"/tab";
                var newTab = dijit.byId(objid);
                if(newTab==null)
                {
                    newTab = new dijit.layout.ContentPane(
                    {
                        id: objid,
                        closeable:'true',
                        title:"<span class='mailIconOptions' align='left'></span>"+title, 
                        href:'/swb/swbadmin/jsp/objectTab.jsp?id='+encodeURIComponent(id)
                    });
                    newTab.closable=true;
                    tabs.addChild(newTab);
                    tabs.selectChild(newTab);                                    
                }else
                {
                    tabs.selectChild(newTab);   
                }
                
            }
            
        </script>
    </head>
    <body class="soria">
        <!-- basic preloader: -->
        <div id="loader"><div id="loaderInner">Loading Semantic WebBuilder... </div></div>
        
        <!-- data for tree and combobox -->
        <div dojoType="dojo.data.ItemFileReadStore" jsId="treeStore" url="/swb/swbadmin/jsp/Tree.jsp"></div>
        <div dojoType="dojo.data.ItemFileReadStore" jsId="sitesStore" url="/swb/swbadmin/jsp/Sites.jsp"></div>        
        <!-- Inline declaration for programmatically created "New Message" tabs --
        <div dojoType="dijit.Declaration" widgetClass="mail.NewMessage">
                <div dojoType="dijit.layout.ContentPane" dojoAttachPoint="container" region="center" href_="mail/newMail.html" closeable="true">
                </div>
        </div>                
        -->
        
        <div dojoType="dijit.Menu" id="submenu1" contextMenuForWindow="false" targetNodeIds="mtree" style="display: none;">
            <div dojoType="dijit.MenuItem" onClick="alert('Hello world');">Enabled Item</div>
            <div dojoType="dijit.MenuItem" disabled="true">Disabled Item</div>
            <div dojoType="dijit.MenuSeparator"></div>
            <div dojoType="dijit.MenuItem" iconClass="dijitEditorIcon dijitEditorIconCut"
   onClick="alert('not actually cutting anything, just a test!')">Cut</div>
            <div dojoType="dijit.MenuItem" iconClass="dijitEditorIcon dijitEditorIconCopy"
   onClick="alert('not actually copying anything, just a test!')">Copy</div>
            <div dojoType="dijit.MenuItem" iconClass="dijitEditorIcon dijitEditorIconPaste"
   onClick="alert('not actually pasting anything, just a test!')">Paste</div>
            <div dojoType="dijit.MenuSeparator"></div>
            <div dojoType="dijit.PopupMenuItem">
                <span>Enabled Submenu</span>
                <div dojoType="dijit.Menu" id="submenu2">
                    <div dojoType="dijit.MenuItem" onClick="alert('Submenu 1!')">Submenu Item One</div>
                    <div dojoType="dijit.MenuItem" onClick="alert('Submenu 2!')">Submenu Item Two</div>
                    <div dojoType="dijit.PopupMenuItem">
                        <span>Deeper Submenu</span>
                        <div dojoType="dijit.Menu" id="submenu4">
                            <div dojoType="dijit.MenuItem" onClick="alert('Sub-submenu 1!')">Sub-sub-menu Item One</div>
                            <div dojoType="dijit.MenuItem" onClick="alert('Sub-submenu 2!')">Sub-sub-menu Item Two</div>
                        </div>
                    </div>
                </div>
            </div>
            <div dojoType="dijit.PopupMenuItem" disabled="true">
                <span>Disabled Submenu</span>
                <div dojoType="dijit.Menu" id="submenu3" style="display: none;">
                    <div dojoType="dijit.MenuItem" onClick="alert('Submenu 1!')">Submenu Item One</div>
                    <div dojoType="dijit.MenuItem" onClick="alert('Submenu 2!')">Submenu Item Two</div>
                </div>
            </div>
            <div dojoType="dijit.PopupMenuItem">
                <span>Different popup</span>
                <div dojoType="dijit.ColorPalette"></div>
            </div>
            <div dojoType="dijit.PopupMenuItem">
                <span>Different popup</span>
                <div dojoType="dijit._Calendar"></div>
            </div>
        </div>        
        
        
            
        <!-- "main" BorderContainer just contains page title and another BorderContainer -->
        <div id="main" dojoType="dijit.layout.BorderContainer">
            
            <!-- toolbar with new mail button, etc. -->
            <div dojoType="dijit.Toolbar" region="top" style="height:25px;" href="/swb/swbadmin/jsp/toolBar.jsp">
                <include src="/swbadmin/jsp/toolBar.jsp"/>
            </div>
            <!-- end toolbar -->
                
            <!-- "mainSplit" BorderContainer has all the real content -->
            <div dojoType="dijit.layout.BorderContainer" liveSplitters="false" design="sidebar" region="center" id="mainSplit">
                
                <!-- "leftSplit" BorderContainer has all the real content -->
                <div dojoType="dijit.layout.BorderContainer" duration="200" minSize="20" style="width: 250px;" splitter="true" region="leading" id="leftSplit">
                    
                    <input dojoType="dijit.form.ComboBox"
                           value="Global"
                           class="medium"
                           store="sitesStore"
                           searchAttr="name"
                           style="width: 250;"
                           name="state2"
                           id="sitesComboBox"
                           region="top"
                           >
                    <div dojoType="dijit.layout.AccordionContainer"  id="leftAccordion" region="center" splitter="true">
                        
                        <div dojoType="dijit.layout.AccordionPane" title="Sitios" selected="true">
                            <!-- tree widget -->
                            <script type="text/javascript">
                                
                                dojo.declare("EditTree", dijit.Tree, {
                                    editing: false,
                                    postCreate: function(){
                                        this.inherited("postCreate", arguments);
                                        this.connect(this.domNode, "ondblclick", this._onDblClick);
                                    },
                                    _onKeyPress: function(/*Event*/ e) {
                                        if (this.tree.editing)  
                                            return; // we are editing so we should ignore all keys
                                        this.inherited(arguments);
                                    },
                                    _onDblClick: function(/*Event*/ e){
                                        var domElement = e.target;
                                        var nodeWidget = dijit.getEnclosingWidget(domElement);  
                                        if(!nodeWidget || !nodeWidget.isTreeNode){
                                            return;
                                        }
                                        this.editing = true; // turn off keys for the tree
                                        
                                        // first we put a span in to attach the editor to. This avoids errors
                                        var labelNode = nodeWidget.labelNode;
                                        var editSpan = document.createElement('span');
                                        editSpan.innerHTML = labelNode.innerHTML;
                                        labelNode.innerHTML = "";
                                        labelNode.appendChild(editSpan);
                                        var editor = new dijit.InlineEditBox({
                                            node: nodeWidget,
                                            tree: this,
                                            model: this.model,
                                            autoSave: true,
                                            onChange: function(val){
                                                this.model.store.setValue(this.node.item,'name', [val]);
                                                this.tree.editing = false;
                                            },
                                            width: "100px"
                                        }, editSpan);
                                        editor.startup();
                                        editor._edit();
                                    }
                                });    
                                
                                dojo.declare("MainTree", dijit.Tree, {
                                    postCreate: function(){
                                        this.inherited("postCreate", arguments);
                                        this.connect(this.domNode, "ondblclick", this._onDblClick);
                                    },
                                    _onDblClick: function(/*Event*/ e){
                                        var domElement = e.target;
                                        var nodeWidget = dijit.getEnclosingWidget(domElement);  
                                        if(!nodeWidget || !nodeWidget.isTreeNode){
                                            return;
                                        }
                                        
                                        var id=treeStore.getValue(nodeWidget.item, "id");
                                        var title=treeStore.getLabel(nodeWidget.item);
                                        var icon=treeStore.getValue(nodeWidget.item, "icon");
                                        addNewTab(id,title,icon);
                                        //alert(newTab);
                                    }
                                });    
                            </script>
                            <div id="mtree" dojoType="MainTree" store="treeStore" query_="{type:'continent'}" label_="Sitios">
                                <script type="dojo/method" event="onClick" args="item">
                                    if(item){
                                        //var newTab = dijit.byId("vprop");    
                                        var id=treeStore.getValue(item, "id");
                                        //newTab.href='/swb/swbadmin/jsp/viewProps.jsp';
                                        getHtml('/swb/swbadmin/jsp/viewProps.jsp?id='+encodeURIComponent(id), "vprop");
                                    }
                                </script>
                                <script type="dojo/method" event="getIconClass" args="item, opened"> 
                                    if(item)
                                    {
                                        return treeStore.getValue(item, "icon");
                                    }
                                </script>                                 
                            </div>
                        </div>
                        
                        <div dojoType="dijit.layout.AccordionPane" title="Repositorios de Usuarios">
                            
                        </div>
                        
                        <div dojoType="dijit.layout.AccordionPane" title="Favoritos">
                            
                        </div>
                        
                    </div><!-- end AccordionContainer -->
                    
                    <div id="vprop" dojoType="dijit.TitlePane" title="View Properties" style="height:150px;" duration="150" minSize="20" splitter="true" region="bottom">
                        View Properties ...
                    </div>
                    
                </div><!-- leftsplit -->

                        <!-- top tabs (marked as "center" to take up the main part of the BorderContainer) -->
                <div dojoType="dijit.layout.TabContainer" region="center" id="tabs" jsId="tabs">
                    <!-- sixth upper tab -->
                    <div id="tab6" dojoType="dijit.layout.ContentPane" title="Home" style="display:none; padding:10px; " closable="false" href_="/swb/swb">
                        <iframe src ="/swb/swb" width="100%" height="100%" frameborder="0"></iframe>
                    </div>
                </div><!-- end of region="center" TabContainer -->
            </div> <!-- end of "mainSplit" BorderContainer -->
        </div><!-- end of "main" BorderContainer -->
        
    </body>
</html>
